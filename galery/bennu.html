<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-P619GVCNJ6"></script>
		<script>
  		window.dataLayer = window.dataLayer || [];
 		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());

  		gtag('config', 'G-P619GVCNJ6');
		</script>

		 <!--FACEBOOK-->
		 <meta property="og:image" content="./../img_as/Bennu.jpg">
		 <meta property="og:image:type" content="image/jpg">
		 <meta property="og:image:width" content="855">
		 <meta property="og:image:height" content="546">
		 <meta property="og:type" content="website" />
		 <meta property="og:url" content="https://www.astrasolaris.org/galery/bennu.html"/>
		 <meta property="og:title" content="Astra Solaris Bennu model" />
		 <meta property="og:description" content="Proyecto de prueba para modelado 3d archivos .stl." />

		<title>AstraSolaris - Bennu Asteroid</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="./../css/main.css">
	</head>
	<body>
		<div id="info">
			<h3><a href="https://es.wikipedia.org/wiki/(101955)_Bennu" target="_blank" rel="noopener">Asteroide Bennu</a></h3>
			Animación por <a href="http://www.astrasolaris.org" target="_blank" rel="noopener">AstraSolaris</a>.
			<a href="https://github.com/SEscobedo/AstraSolaris/tree/master/galery/bennu.html" target="_blank" rel="noopener">Ver Código fuente</a><br/>
			Modelo 3D por <a href="https://nasa3d.arc.nasa.gov/detail/bennu">NASA</a>
		</div>

		<script type="module">

			import * as THREE from './../node_modules/three/build/three.module.js';
			import Stats from './../node_modules/three/examples/jsm/libs/stats.module.js';

			import { STLLoader } from './../node_modules/three/examples/jsm/loaders/STLLoader.js';
			import { GLTFLoader } from './../node_modules/three/examples/jsm/loaders/GLTFLoader.js';
			//import { RoughnessMipmapper } from './../node_modules/three/examples/jsm/utils/RoughnessMipmapper.js';

			let container, stats, asteroid;

			let camera, cameraTarget, scene, renderer;

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.3, 15 );
				camera.position.set( 2.5, 0.3, 2.5 );

				cameraTarget = new THREE.Vector3( 0, 0, 0 );

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0x16161a );
				scene.fog = new THREE.Fog( 0x72645b, 0.05, 7 );

				// Ground

				const plane = new THREE.Mesh(
					new THREE.PlaneBufferGeometry( 40, 40 ),
					new THREE.MeshPhongMaterial( { color: 0x999999, specular: 0x101010 } )
				);
				plane.rotation.x = - Math.PI / 2;
				plane.position.y = - 0.5;
				scene.add( plane );

				plane.receiveShadow = true;


				// ASCII file

				const loader = new STLLoader();
		
				
				//const texture = new THREE.TextureLoader().load('./../models/textures/Bennu_Global_Mosaic.jpg')
				//const material = new THREE.MeshStandardMaterial( { map: texture} );

				const material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );
				

				// Colored binary STL
				loader.load( './../models/stl/Bennu/Bogus_Bennu_Shape.stl', function ( geometry ) {

				asteroid = new THREE.Mesh( geometry, material );

				asteroid.position.set( 0,  0.1, 0 );
				asteroid.rotation.set( 0, 0, 0 );
				asteroid.scale.set( 1, 1, 1 );

				asteroid.castShadow = true;
				asteroid.receiveShadow = true;

				scene.add( asteroid );

				} );

				
				//Format gltf
				// Instantiate a loader
				/*const loaderGLtf = new GLTFLoader();

				// Load a glTF resource
				loaderGLtf.load(
				// resource URL
				'./../models/glTF/Osiris_Rex.glb',
				// called when the resource is loaded
				function ( gltf ) {

					gltf.scene.traverse( function ( child ) {

					if ( child.isMesh ) {

							child.castShadow = true; 
							child.receiveShadow = true; 
					}

					} );
					
					

					gltf.scene.position.set( 1, 0.15, 0);
					gltf.scene.rotation.set( - Math.PI / 2,0, Math.PI / 2 );
					gltf.scene.scale.set( 0.05, 0.05, 0.05 )

					scene.add( gltf.scene );
				
				},

				// called while loading is progressing
				function ( xhr ) {

					console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );

				},
				// called when loading has errors
				function ( error ) {

					console.log( 'An error happened: ' + error );

				}
				);*/

			/*const loaderGltf = new GLTFLoader().setPath( './../models/glTF/' );
			loaderGltf.load( 'Osiris_Rex.glb', function ( gltf ) {

				gltf.scene.traverse( function ( child ) {

					if ( child.isMesh ) {

							child.castShadow = true; 
							child.receiveShadow = true; 
						// TOFIX RoughnessMipmapper seems to be broken with WebGL 2.0
							//roughnessMipmapper.generateMipmaps( child.material );

					}

				} );
				
				gltf.scene.position.set( 1, 0.15, 0);
				gltf.scene.rotation.set( - Math.PI / 2,0, Math.PI / 2 );
				gltf.scene.scale.set( 0.05, 0.05, 0.05 );


				scene.add( gltf.scene );

				//roughnessMipmapper.dispose();

			} );*/

			var manager = new THREE.LoadingManager();

			manager.onProgress = function ( url, itemsLoaded, itemsTotal ) {
    		progressElement.style.width = (itemsLoaded / itemsTotal * 100) + '%';
			};

			var Loaders = {
    		Texture: new THREE.TextureLoader(manager)
			}
						

				// Lights

				scene.add( new THREE.HemisphereLight( 0x443333, 0x111122 ) );

				addShadowedLight( 1, 1, 1, 0xffffff, 1.35 );
				addShadowedLight( 0.5, 1, - 1, 0xffaa00, 1 );

				// renderer

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.outputEncoding = THREE.sRGBEncoding;

				renderer.shadowMap.enabled = true;

			
				container.appendChild( renderer.domElement );

				// stats

				stats = new Stats();
				container.appendChild( stats.dom );

				window.addEventListener( 'resize', onWindowResize, false );

			}


			function addShadowedLight( x, y, z, color, intensity ) {

				const directionalLight = new THREE.DirectionalLight( color, intensity );
				directionalLight.position.set( x, y, z );
				scene.add( directionalLight );

				directionalLight.castShadow = true;

				const d = 1;
				directionalLight.shadow.camera.left = - d;
				directionalLight.shadow.camera.right = d;
				directionalLight.shadow.camera.top = d;
				directionalLight.shadow.camera.bottom = - d;

				directionalLight.shadow.camera.near = 1;
				directionalLight.shadow.camera.far = 4;

				directionalLight.shadow.bias = - 0.002;

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );
				

				render();
				stats.update();


			}

			function render() {

				const timer = Date.now() * 0.0002;

				camera.position.x = Math.cos( timer / 5 ) * 3;
				camera.position.z = Math.sin( timer / 5 ) * 3;
				//asteroid.rotation.set( 0,-2*timer, 0 );

				camera.lookAt( cameraTarget );

				renderer.render( scene, camera );

			}

		</script>
	</body>
</html>
