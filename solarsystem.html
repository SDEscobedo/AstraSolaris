<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astra Solaris 3D Beta</title>
    <link type="text/css" rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="./node_modules/xterm/css/xterm.css" />
    <script src="./node_modules/xterm/lib/xterm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.js"></script> 

</head>

<body>

  <script type ="module" src="js/astra.js"></script>

<div id="control_panel" >
  <div id="info">
    <br/>
    <a href="index.html" target="_blank" rel="noopener">Astra Solaris BETA</a> - Sistema Solar [Escala real]<br/>
    <!-- <b>WASD</b> move, <b>R|F</b> up | down, <b>Q|E</b> roll, <b>up|down</b> pitch, <b>left|right</b> yaw -->

  
    <button id="Sol">Sol</button>
    <button id="Mercurio">Mercurio</button>
    <button id="Venus">Venus</button>
    <button id="Tierra">Tierra</button>
    <button id="Luna">-Luna-</button>
    <button id="Marte">Marte</button>
    <button id="Jupiter">Jupiter</button>
    <button id="Saturno">Saturno</button>
    <button id="Urano">Urano</button>
    <button id="Neptuno">Neptuno</button>
  </div>
</div>

<div id="disp" class="display">
  <div style="display:flex; flex-direction: row;">
    <div style="width: 50%; text-align: left;">Terminal de comandos</div> <div style=" width : 50%;"><a href="astra_commands_reference.html" target="_blank" style="color: lightgray;text-align: right;" >Ayuda</a></div> 
  </div>
  
</div>

<script type="module">
  import {CommandExecute} from './js/astra.js';
  var term = new Terminal({
    cursorBlink: "block",
    rows: 8, 
    cols: 45
  });


  const ws = new WebSocket("ws://localhost:3000", "echo-protocol");
  var curr_line = "";
  var entries = [];
  term.open( document.getElementById('disp'));
  //fitAddon.fit();
  term.write("Macrocosmos 2020: Astra 1.0\r\n");
  term.write("command *> ");
  

  term.prompt = () => {
    if (curr_line) {
    let data = { method: "command", command: curr_line };
    ws.send(JSON.stringify(data));
    }
  };
  term.prompt();
  

  // Receive data from socket
  ws.onmessage = msg => {
    term.write("\r\n" + JSON.parse(msg.data).data);
    curr_line = "";
  };

  term.on("key", function(key, ev) {
    //Enter
    if (ev.keyCode === 13) {
    if (curr_line) {
      entries.push(curr_line);

      //creo que aquÃ­ es lo bueno*******************************

      term.write(CommandExecute(curr_line));
				  curr_line = "";
				  term.write("\r\n*> ");
	  
				  //:)********************************************************
      //term.write("\r\n > ");

      term.prompt();
    }

    } else if (ev.keyCode === 8) {
    // Backspace
    if (curr_line) {
      curr_line = curr_line.slice(0, curr_line.length - 1);
      term.write("\b \b");
    }
    } else {
    curr_line += key;
    term.write(key);
    }
  });

  // paste value
  term.on("paste", function(data) {
    curr_line += data;
    term.write(data);
  });

 
  </script>

</body>
</html>
